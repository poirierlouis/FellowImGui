<div id="fig-tree-factory"
     class="widget-bar"
     cdkDropList
     cdkDropListConnectedTo="fig-tree-drop"
     [cdkDropListData]="widgetBuilders"
     (cdkDropListEntered)="onDropEntered($event)"
     (cdkDropListExited)="onDropExited($event)">
  <!-- Widget's preview -->
  <ng-template #preview let-widget>
    <div class="fig-widget-preview create"
         [class.child]="widget.type !== 'window'">
      <div class="content">
        <mat-icon [svgIcon]="widget.icon"></mat-icon>

        {{ widget.title }}
      </div>

      <mat-icon>drag_handle</mat-icon>
    </div>
  </ng-template>

  <!-- Widget's placeholder -->
  <ng-template #placeholder let-widget>
    <div class="fig-widget-placeholder create"
         [class.child]="widget.type !== 'window'">
      <div class="content">
        <mat-icon [svgIcon]="widget.icon"></mat-icon>

        {{ widget.title }}
      </div>

      <mat-icon>drag_handle</mat-icon>
    </div>
  </ng-template>

  @for (builder of widgetBuilders; track builder.type) {
    <mat-icon [svgIcon]="builder.icon"
              [matTooltip]="builder.title"
              cdkDrag
              [cdkDragData]="builder.type"
              (cdkDragStarted)="onDragStart($event)"
              (cdkDragEnded)="onDragEnded()"
              (cdkDragExited)="onDragExited($event)">
      <ng-container *cdkDragPlaceholder>
        <ng-container *ngTemplateOutlet="placeholder; context: {$implicit: builder}"></ng-container>
      </ng-container>

      <ng-container *cdkDragPreview>
        <ng-container *ngTemplateOutlet="preview; context: {$implicit: builder}"></ng-container>
      </ng-container>
    </mat-icon>
  }
</div>

<div class="panels">
  <fig-tree [document]="document"
            (selectWidget)="selectWidget($event)"></fig-tree>

  <fig-canvas [document]="document"></fig-canvas>

  <fig-properties [widget]="selectedWidget"
                  (update)="updateWidget($event)"></fig-properties>
</div>
